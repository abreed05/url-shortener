FROM --platform=linux/amd64 golang:1.23.2-bookworm
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG MICROSERVICE
ENV AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY
ENV MICROSERVICE=$MICROSERVICE

WORKDIR /go/src/url-shortener

COPY ./${MICROSERVICE}/bin/${MICROSERVICE} /usr/local/bin/${MICROSERVICE}
RUN chmod +x /usr/local/bin/${MICROSERVICE}

CMD ["bash", "-c", "${MICROSERVICE}"]